!function(e,r){var t,n,a={routeChangeStart:"jqRouter.routeChangeStart",routeChangeSucess:"jqRouter.routeChangeSucess",renderViewSucess:"jqRouter.renderViewSucess"},u={route:{},params:{}};t=function(){var t,s={},o=!0,h={Param_Replacer:"([^/]+)",Param_Matcher:/:([\w\d]+)/g};return s.getCurrentParams=function(){return u.params},s.getCurrentRoute=function(){return u.route},s.getRouteName=function(e){return this.routes[e]},s.getRouteParams=function(e){for(var r={},t=e.urlExpr.exec(e.url),n=0;n<e.params.length;n++)r[e.params[n]]=t[n+1];return r},s.go=function(e,t){var n=this;return r.location=n.href(e,t),n},s.href=function(e,r){e=e||t;for(var n=this.routes[e],a=n.relativeUrl,u=0;u<n.params.length;u++)a=a.replace(":"+n.params[u],r[n.params[u]]);return a},s.isRouteParamChanged=function(e,r){var t=this;return t.href(e,r)!==t.href(e,t.getCurrentParams())},s.match=function(e){var r,t=this;for(var n in t.routes)t.routes[n].abstract||null===t.routes[n].urlExpr.exec(e)||(r=t.routes[n]);return r},s.onhashchange=function(s){var o,h=this,i=h.match(s);return i?(i.previousUrl=u.route.url||s,i.url=s,o=h.getRouteParams(i),e(r).trigger(a.routeChangeStart,[i,o]),n.processRoute(i).then(function(){n.render(i,o),u.route=i,u.params=o,e(r).trigger(a.routeChangeSucess,[i,o])})):h.go(t),h},s.onViewChange=function(t){var n=this;return e(r).on(a.renderViewSucess,t),n},s.run=function(t,a,u){var s=this;return o&&(n.setViewSelector(t),e(r).on("hashchange",function(){s.onhashchange(r.location.hash)}),s.match(r.location.hash)?s.onhashchange(r.location.hash):s.go(a,u),o=!1),s},s.setData=function(e){var r=this;r.routes={};for(var t in e){for(var n,a=t.split("."),u=[],s="",o="",i=r.routes[t]={segments:[],params:[]},c=0;c<a.length;c++){u.push(a[c]);var l=u.join(".");s+=e[l].url,i.segments.push(l)}for(;null!==(n=h.Param_Matcher.exec(s));)i.params.push(n[1]);o=new RegExp(s.replace(h.Param_Matcher,h.Param_Replacer)+"$"),i.abstract=e[t].abstract,i.name=t,i.relativeUrl=s,i.urlExpr=o,i.templateUrl=e[t].templateUrl,i.controller=e[t].controller}return r},s.setDefault=function(e){return t=e,this},s}(),n=function(t){var n,u={},s={};return u.getViewTemplate=function(r){return e.get({url:r,dataType:"html"}).then(function(e){s[r]=e})},u.processRoute=function(r){for(var n=this,a=[],u=0;u<r.segments.length;u++){var o=t.getRouteName(r.segments[u]);s[o.templateUrl]||a.push(n.getViewTemplate(o.templateUrl))}return e.when.apply(e,a)},u.render=function(u,o){for(var h=t.getCurrentRoute(),i=e.isEmptyObject(h),c=0;c<u.segments.length;c++){var l=t.getRouteName(u.segments[c]),g=e(n+":eq("+c+")");i||(i=u.segments[c]!==h.segments[c]||t.isRouteParamChanged(u.segments[c],o)),i&&(g.html(s[l.templateUrl]),e(r).trigger(a.renderViewSucess,[l,u,o]))}return this},u.setViewSelector=function(e){return n=e,this},u}(t),e.router=t}(jQuery,this);