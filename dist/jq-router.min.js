!function(e,r){var t,n,a={routeChangeStart:"jqRouter.routeChangeStart",routeChangeSucess:"jqRouter.routeChangeSucess",renderViewSucess:"jqRouter.renderViewSucess",viewDestroyed:"jqRouter.viewDestroyed"},u={route:{},params:{}};t=function(){var t,o={},s=!0,i={Param_Replacer:"([^/]+)",Param_Matcher:/:([\w\d]+)/g};return o.getCurrentParams=function(){return u.params},o.getCurrentRoute=function(){return u.route},o.getRouteName=function(e){return this.routes[e]},o.getRouteParams=function(e){for(var r={},t=e.urlExpr.exec(e.url),n=0;n<e.params.length;n++)r[e.params[n]]=t[n+1];return r},o.go=function(e,t){var n=this;return r.location=n.href(e,t),n},o.href=function(e,r){e=e||t;for(var n=this.routes[e],a=n.relativeUrl,u=0;u<n.params.length;u++)a=a.replace(":"+n.params[u],r[n.params[u]]);return a},o.isRouteParamChanged=function(e,r){var t=this;return t.href(e,r)!==t.href(e,t.getCurrentParams())},o.match=function(e){var r,t=this;for(var n in t.routes)t.routes[n].abstract||null===t.routes[n].urlExpr.exec(e)||(r=t.routes[n]);return r},o.onhashchange=function(o){var s,i=this,h=i.match(o);return h?(h.previousUrl=u.route.url||o,h.url=o,s=i.getRouteParams(h),e(r).trigger(a.routeChangeStart,[h,s]),n.processRoute(h).then(function(){n.render(h,s),u.route=h,u.params=s,e(r).trigger(a.routeChangeSucess,[h,s])})):i.go(t),i},o.onViewChange=function(t){var n=this;return e(r).on(a.renderViewSucess,t),n},o.onViewDestroyed=function(t){var n=this;return e(r).on(a.viewDestroyed,t),n},o.run=function(t,a,u){var o=this;return s&&(n.setViewSelector(t),e(r).on("hashchange",function(){o.onhashchange(r.location.hash)}),o.match(r.location.hash)?o.onhashchange(r.location.hash):o.go(a,u),s=!1),o},o.setData=function(e){var r=this;r.routes={};for(var t in e){for(var n,a=t.split("."),u=[],o="",s="",h=r.routes[t]={segments:[],params:[]},c=0;c<a.length;c++){u.push(a[c]);var l=u.join(".");o+=e[l].url,h.segments.push(l)}for(;null!==(n=i.Param_Matcher.exec(o));)h.params.push(n[1]);s=new RegExp(o.replace(i.Param_Matcher,i.Param_Replacer)+"$"),h.abstract=e[t].abstract,h.name=t,h.relativeUrl=o,h.urlExpr=s,h.templateUrl=e[t].templateUrl,h.controller=e[t].controller}return r},o.setDefault=function(e){return t=e,this},o}(),n=function(t){var n,u={},o={};return u.clean=function(n,u){for(var o=n.length-1;o>=u;o--){var s=t.getRouteName(n[o]);e(r).trigger(a.viewDestroyed,[s])}},u.getViewTemplate=function(r){return e.get({url:r,dataType:"html"}).then(function(e){o[r]=e})},u.processRoute=function(r){for(var n=this,a=[],u=0;u<r.segments.length;u++){var s=t.getRouteName(r.segments[u]);o[s.templateUrl]||a.push(n.getViewTemplate(s.templateUrl))}return e.when.apply(e,a)},u.render=function(s,i){for(var h=t.getCurrentRoute(),c=e.isEmptyObject(h),l=0;l<s.segments.length;l++){var g=t.getRouteName(s.segments[l]),m=e(n+":eq("+l+")");c||(c=s.segments[l]!==h.segments[l]||t.isRouteParamChanged(s.segments[l],i))&&u.clean(h.segments,l),c&&(m.html(o[g.templateUrl]),e(r).trigger(a.renderViewSucess,[g,s,i]))}return this},u.setViewSelector=function(e){return n=e,this},u}(t),e.router=t}(jQuery,this);