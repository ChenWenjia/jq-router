!function(e,t){var r,n,u,s=!0,o={routeChangeStart:"router.routeChangeStart",routeChangeSucess:"router.routeChangeSucess",renderViewSucess:"render.renderViewSucess"};r=function(){function a(){var n=t.location.hash,s=r.match(n);s&&(e(t).trigger(o.routeChangeStart,[s]),u.processRoute(s,c.routes).then(function(){u.render(i,s,c.routes),e(t).trigger(o.routeChangeSucess,[s]),i=s}))}var i,c={};return c.match=function(e){var t,r=this;for(var n in r.routes)r.routes[n].abstract||r.routes[n].url!==e||(t=r.routes[n]);return t},c.setData=function(e){var t=this;t.routes={};for(var r in e){var n=r.split("."),u=[],s="",o=t.routes[r]={segments:[]};for(var a in n){u.push(n[a]);var i=u.join(".");s+=e[i].url,o.segments.push(i)}o.name=r,o.url=s,o.templateUrl=e[r].templateUrl,o.controller=e[r].controller}return t},c.setDefault=function(e){return n=e,this},c.getCurrentRoute=function(){return i},c.go=function(e,r){var u=this;return e=e||n,t.location=u.routes[e].url,u},c.run=function(r,n,o){var i=this;return s&&(u.setViewSelector(r),e(t).on("hashchange",a),i.match(t.location.hash)?a():i.go(n,o),s=!1),i},c.onViewChange=function(r){var n=this;return e(t).on(o.renderViewSucess,r),n},c}(),u=function(){var r,n={},u={};return n.setViewSelector=function(e){return r=e,this},n.getViewTemplate=function(t){return e.get(t,"html").then(function(e){u[t]=e})},n.processRoute=function(t,r){var n=this,s=[];for(var o in t.segments){var a=r[t.segments[o]];u[a.templateUrl]||s.push(n.getViewTemplate(a.templateUrl))}return e.when.apply(e,s)},n.render=function(n,s,a){for(var i in s.segments){var c=a[s.segments[i]],h=e(r+":eq("+i+")");n&&s.segments[i]===n.segments[i]||(h.html(u[c.templateUrl]),e(t).trigger(o.renderViewSucess,[c]))}},n}(),e.router=r}(jQuery,this);