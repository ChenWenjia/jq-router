!function(e,t){var r,n,a={routeChangeStart:"jqRouter.routeChangeStart",routeChangeSuccess:"jqRouter.routeChangeSuccess",renderViewSuccess:"jqRouter.renderViewSuccess",viewDestroyed:"jqRouter.viewDestroyed"},o={route:{},params:{}};r=function(){var r,u={},s=!0,i={Param_Replacer:"([^/]+)",Param_Matcher:/:([\w\d]+)/g};return u.getCurrentParams=function(){return o.params},u.getCurrentRoute=function(){return o.route},u.getRouteName=function(e){return this.routes[e]},u.getRouteParams=function(e){for(var t={},r=e.urlExpr.exec(e.url),n=0;n<e.params.length;n++)t[e.params[n]]=r[n+1];return t},u.go=function(e,r){var n=this;return t.location=n.href(e,r),n},u.href=function(e,t){e=e||r;for(var n=this.routes[e],a=n.relativeUrl,o=0;o<n.params.length;o++)a=a.replace(":"+n.params[o],t[n.params[o]]);return a},u.isRouteParamChanged=function(e,t){var r=this;return r.href(e,t)!==r.href(e,r.getCurrentParams())},u.match=function(e){var t,r=this;for(var n in r.routes)r.routes[n].abstract||null===r.routes[n].urlExpr.exec(e)||(t=r.routes[n]);return t},u.onhashchange=function(u){var s,i=this,c=i.match(u);return c?(c.previousUrl=o.route.url||u,c.url=u,s=i.getRouteParams(c),e(t).trigger(a.routeChangeStart,[c,s]),n.processRoute(c).then(function(){n.render(c,s),o.route=c,o.params=s,e(t).trigger(a.routeChangeSuccess,[c,s])})):i.go(r),i},u.onRouteBeforeChange=function(r){var n=this;return e(t).on(a.routeChangeStart,r),n},u.onRouteChanged=function(r){var n=this;return e(t).on(a.routeChangeSuccess,r),n},u.onViewChange=function(r){var n=this;return e(t).on(a.renderViewSuccess,r),n},u.onViewDestroyed=function(r){var n=this;return e(t).on(a.viewDestroyed,r),n},u.run=function(r,a,o){var u=this;if(s){if(-1===t.location.pathname.lastIndexOf(".")&&"/"!==t.location.pathname.substr(-1))return void(t.location.pathname=t.location.pathname+"/");n.setViewSelector(r),e(t).on("hashchange",function(){u.onhashchange(t.location.hash)}),u.match(t.location.hash)?u.onhashchange(t.location.hash):u.go(a,o),s=!1}return u},u.setData=function(e){var t=this;t.routes={};for(var r in e){for(var n,a=r.split("."),o=[],u="",s="",c=t.routes[r]={segments:[],params:[]},h=0;h<a.length;h++){o.push(a[h]);var l=o.join(".");u+=e[l].url,c.segments.push(l)}for(;null!==(n=i.Param_Matcher.exec(u));)c.params.push(n[1]);s=new RegExp(u.replace(i.Param_Matcher,i.Param_Replacer)+"$"),c.abstract=e[r].abstract,c.name=r,c.relativeUrl=u,c.urlExpr=s,c.templateUrl=e[r].templateUrl,c.controller=e[r].controller}return t},u.setDefault=function(e){return r=e,this},u}(),n=function(r){var n,o={},u={};return o.clean=function(n,o){for(var u=n.length-1;u>=o;u--){var s=r.getRouteName(n[u]);e(t).trigger(a.viewDestroyed,[s])}},o.getViewTemplate=function(t){return e.get({url:t,dataType:"html"}).then(function(e){u[t]=e})},o.processRoute=function(t){for(var n=this,a=[],o=0;o<t.segments.length;o++){var s=r.getRouteName(t.segments[o]);u[s.templateUrl]||a.push(n.getViewTemplate(s.templateUrl))}return e.when.apply(e,a)},o.render=function(s,i){for(var c=r.getCurrentRoute(),h=e.isEmptyObject(c),l=0;l<s.segments.length;l++){var g=r.getRouteName(s.segments[l]),m=e(n+":eq("+l+")");h||(h=s.segments[l]!==c.segments[l]||r.isRouteParamChanged(s.segments[l],i))&&o.clean(c.segments,l),h&&(m.html(u[g.templateUrl]),e(t).trigger(a.renderViewSuccess,[g,s,i]))}return this},o.setViewSelector=function(e){return n=e,this},o}(r),e.router=r}(jQuery,this);