!function(e,t){var r,n,a,o={routeChangeStart:"jqRouter.routeChangeStart",routeChangeSuccess:"jqRouter.routeChangeSuccess",renderViewSuccess:"jqRouter.renderViewSuccess",viewDestroyed:"jqRouter.viewDestroyed"},u={route:{},params:{}};r=function(){var r,s={},i=!0,c={Param_Replacer:"([^/]+)",Param_Matcher:/:([\w\d]+)/g};return s.getCurrentParams=function(){return u.params},s.getCurrentRoute=function(){return u.route},s.getRouteName=function(e){return this.routes[e]},s.getRouteParams=function(t){for(var r={},a=t.urlExpr.exec(t.url),o=0;o<t.params.length;o++)r[t.params[o]]=a[o+1];return e.extend({},n.getParams(),r)},s.go=function(e,r){var a=this;return n.setParams(r),t.location=a.href(e,r),a},s.href=function(e,t){e=e||r;for(var n=this.routes[e],a=n.relativeUrl,o=0;o<n.params.length;o++)a=a.replace(":"+n.params[o],t[n.params[o]]);return a},s.isRouteParamChanged=function(e,t){var r=this;return r.href(e,t)!==r.href(e,r.getCurrentParams())},s.match=function(e){var t,r=this;for(var n in r.routes)r.routes[n].abstract||null===r.routes[n].urlExpr.exec(e)||(t=r.routes[n]);return t},s.onhashchange=function(n){var s,i=this,c=i.match(n);return c?(c.previousUrl=u.route.url||n,c.url=n,s=i.getRouteParams(c),e(t).trigger(o.routeChangeStart,[c,s]),a.processRoute(c).then(function(){a.render(c,s),u.route=c,u.params=s,e(t).trigger(o.routeChangeSuccess,[c,s])})):i.go(r),i},s.onRouteBeforeChange=function(r){var n=this;return e(t).on(o.routeChangeStart,r),n},s.onRouteChanged=function(r){var n=this;return e(t).on(o.routeChangeSuccess,r),n},s.onViewChange=function(r){var n=this;return e(t).on(o.renderViewSuccess,r),n},s.onViewDestroyed=function(r){var n=this;return e(t).on(o.viewDestroyed,r),n},s.run=function(r,n,o){var u=this;if(i){if(-1===t.location.pathname.lastIndexOf(".")&&"/"!==t.location.pathname.substr(-1))return void(t.location.pathname=t.location.pathname+"/");a.setViewSelector(r),e(t).on("hashchange",function(){u.onhashchange(t.location.hash)}),u.match(t.location.hash)?u.onhashchange(t.location.hash):u.go(n,o),i=!1}return u},s.setData=function(e){var t=this;t.routes={};for(var r in e){for(var n,a=r.split("."),o=[],u="",s="",i=t.routes[r]={segments:[],params:[]},h=0;h<a.length;h++){o.push(a[h]);var g=o.join(".");u+=e[g].url,i.segments.push(g)}for(;null!==(n=c.Param_Matcher.exec(u));)i.params.push(n[1]);s=new RegExp(u.replace(c.Param_Matcher,c.Param_Replacer)+"$"),i.abstract=e[r].abstract,i.name=r,i.relativeUrl=u,i.urlExpr=s,i.templateUrl=e[r].templateUrl,i.controller=e[r].controller}return t},s.setDefault=function(e){return r=e,this},s}(),a=function(){var n,a={},u={};return a.clean=function(n,a){for(var u=n.length-1;u>=a;u--){var s=r.getRouteName(n[u]);e(t).trigger(o.viewDestroyed,[s])}},a.getViewTemplate=function(t){return e.get({url:t,dataType:"html"}).then(function(e){u[t]=e})},a.processRoute=function(t){for(var n=this,a=[],o=0;o<t.segments.length;o++){var s=r.getRouteName(t.segments[o]);u[s.templateUrl]||a.push(n.getViewTemplate(s.templateUrl))}return e.when.apply(e,a)},a.render=function(s,i){for(var c=r.getCurrentRoute(),h=e.isEmptyObject(c),g=0;g<s.segments.length;g++){var l=r.getRouteName(s.segments[g]),m=e(n+":eq("+g+")");h||(h=s.segments[g]!==c.segments[g]||r.isRouteParamChanged(s.segments[g],i))&&a.clean(c.segments,g),h&&(m.html(u[l.templateUrl]),e(t).trigger(o.renderViewSuccess,[l,s,i]))}return this},a.setViewSelector=function(e){return n=e,this},a}(),n=function(){var e,t={};return t.setParams=function(t){e=t},t.getParams=function(){return e},t}(),e.router=r}(jQuery,this);