!function(e,r){var t,a,n={routeChangeStart:"jqRouter.routeChangeStart",routeChangeSucess:"jqRouter.routeChangeSucess",renderViewSucess:"jqRouter.renderViewSucess"},u={route:{},params:{}};t=function(){var t,o={},s=!0,h={Param_Replacer:"([^/]+)",Param_Matcher:/:([\w\d]+)/g};return o.getCurrentParams=function(){return u.params},o.getCurrentRoute=function(){return u.route},o.getRouteName=function(e){return this.routes[e]},o.getRouteParams=function(e){for(var r={},t=e.urlExpr.exec(e.url),a=0;a<e.params.length;a++)r[e.params[a]]=t[a+1];return r},o.go=function(e,t){var a=this;return r.location=a.href(e,t),a},o.href=function(e,r){var a=this;e=e||t,route=a.routes[e],url=route.relativeUrl;for(var n=0;n<route.params.length;n++)url=url.replace(":"+route.params[n],r[route.params[n]]);return url},o.isRouteParamChanged=function(e,r){var t=this;return t.href(e,r)!==t.href(e,t.getCurrentParams())},o.match=function(e){var r,t=this;for(var a in t.routes)t.routes[a].abstract||null===t.routes[a].urlExpr.exec(e)||(r=t.routes[a]);return r},o.onhashchange=function(o){var s,h=this,i=h.match(o);return i?(i.previousUrl=u.route.url||o,i.url=o,s=h.getRouteParams(i),e(r).trigger(n.routeChangeStart,[i,s]),a.processRoute(i).then(function(){a.render(i,s),u.route=i,u.params=s,e(r).trigger(n.routeChangeSucess,[i,s])})):h.go(t),h},o.onViewChange=function(t){var a=this;return e(r).on(n.renderViewSucess,t),a},o.run=function(t,n,u){var o=this;return s&&(a.setViewSelector(t),e(r).on("hashchange",function(){o.onhashchange(r.location.hash)}),o.match(r.location.hash)?o.onhashchange(r.location.hash):o.go(n,u),s=!1),o},o.setData=function(e){var r=this;r.routes={};for(var t in e){for(var a,n=t.split("."),u=[],o="",s="",i=r.routes[t]={segments:[],params:[]},c=0;c<n.length;c++){u.push(n[c]);var l=u.join(".");o+=e[l].url,i.segments.push(l)}for(;null!==(a=h.Param_Matcher.exec(o));)i.params.push(a[1]);s=new RegExp(o.replace(h.Param_Matcher,h.Param_Replacer)+"$"),i.abstract=e[t].abstract,i.name=t,i.relativeUrl=o,i.urlExpr=s,i.templateUrl=e[t].templateUrl,i.controller=e[t].controller}return r},o.setDefault=function(e){return t=e,this},o}(),a=function(t){var a,u={},o={};return u.getViewTemplate=function(r){return e.get({url:r,dataType:"html"}).then(function(e){o[r]=e})},u.processRoute=function(r){for(var a=this,n=[],u=0;u<r.segments.length;u++){var s=t.getRouteName(r.segments[u]);o[s.templateUrl]||n.push(a.getViewTemplate(s.templateUrl))}return e.when.apply(e,n)},u.render=function(u,s){for(var h=t.getCurrentRoute(),i=e.isEmptyObject(h),c=0;c<u.segments.length;c++){var l=t.getRouteName(u.segments[c]),g=e(a+":eq("+c+")");i||(i=u.segments[c]!==h.segments[c]||t.isRouteParamChanged(u.segments[c],s)),i&&(g.html(o[l.templateUrl]),e(r).trigger(n.renderViewSucess,[l,s]))}return this},u.setViewSelector=function(e){return a=e,this},u}(t),e.router=t}(jQuery,this);